
SELECT A.FCH_PROCESO, 'BANCA EMPRESAS' BD_VICEPRECIDENTE, A.COD_AREA_FINANCIERA, B.AREA_FINANCIERA,
A.COD_ASIGNADO, NULL NOMBRE_EJECUTIVO, 	   
CASE WHEN A.COD_ASIGNADO IN (913,698,679,619,508,507,506,505,502,199,116,111,95,94,92,24,19,10) THEN 'NO GERENCIADO'
ELSE 'GERENCIADO' END AS GERENCIAMIENTO, 
ISNULL(C.MASTER, A.NO_UNICO) BK_MASTER, ISNULL(C.NOMBRE_GRUPO, A.CLIENTE) BD_MASTER, 
A.NO_UNICO, A.CLIENTE,  A.SEGMENT2 AGRUPADOR, D.AGRUPACION_PRODUCTO COLAGRUPADOR,
CASE WHEN A.COD_PRODUCTO IN ('20106','20132','20107','20108','20117','20167','20168','20134') 
THEN 'CASH MANAGER' ELSE A.SEGMENT2 END AS AGRUPADOR_VAL,
  A.COD_PRODUCTO, A.PRODUCTO, A.NO_CUENTA
FROM SALDOS_2017 A JOIN DATA_EMPRESAS.DBO.AREAS_FINANCIERAS B ON A.COD_AREA_FINANCIERA = B.COD_AREA_FINANCIERA
JOIN DATA_EMPRESAS.DBO.VW_CLIENTES_ULT_MES C ON A.NO_UNICO = C.NO_UNICO 
JOIN DATA_EMPRESAS.DBO.CATALOGO_PRODUCTOS D ON A.COD_PRODUCTO = D.COD_PRODUCTO
WHERE A.FCH_PROCESO IN (SELECT MAX(FCH_PROCESO) FROM SALDOS_2017 WHERE YEAR(FCH_PROCESO)=2019 GROUP BY MONTH(FCH_PROCESO))
AND MONTH(A.FCH_PROCESO) != 11
UNION 
SELECT  A.FCH_PROCESO, 'BANCA EMPRESAS' BD_VICEPRECIDENTE, A.COD_AREA_FINANCIERA, B.AREA_FINANCIERA,
C.COD_ASIGNADO, NULL NOMBRE_EJECUTIVO, 	   
CASE WHEN C.COD_ASIGNADO IN (913,698,679,619,508,507,506,505,502,199,116,111,95,94,92,24,19,10) THEN 'NO GERENCIADO'
ELSE 'GERENCIADO' END AS GERENCIAMIENTO, 
ISNULL(C.MASTER, A.NO_UNICO) BK_MASTER, ISNULL(C.NOMBRE_GRUPO, C.NOMBRE_CLIENTE) BD_MASTER, 
A.NO_UNICO, C.NOMBRE_CLIENTE,  A.SEGMENT2 AGRUPADOR, D.AGRUPACION_PRODUCTO COLAGRUPADOR,
CASE WHEN A.COD_PRODUCTO IN ('20106','20132','20107','20108','20117','20167','20168','20134') 
THEN 'CASH MANAGER' ELSE A.SEGMENT2 END AS AGRUPADOR_VAL,
  A.COD_PRODUCTO, D.NOMBRE_PRODUCTO, A.NO_CUENTA
FROM OTROS_PROD_DASH A JOIN DATA_EMPRESAS.DBO.AREAS_FINANCIERAS B ON A.COD_AREA_FINANCIERA = B.COD_AREA_FINANCIERA
JOIN DATA_EMPRESAS.DBO.VW_CLIENTES_ULT_MES C ON A.NO_UNICO = C.NO_UNICO 
JOIN DATA_EMPRESAS.DBO.CATALOGO_PRODUCTOS D ON A.COD_PRODUCTO = D.COD_PRODUCTO
WHERE FCH_PROCESO = (SELECT MAX(FCH_PROCESO) FROM OTROS_PROD_DASH) 
AND A.COD_AREA_FINANCIERA IN ('1101','1123','1120','1111','1112','1113','1106','1103')

